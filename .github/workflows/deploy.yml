name: Deploy via Kudu API

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

<<<<<<< HEAD
    - name: Debug - List all files
      run: |
        echo "ðŸ“ Project structure:"
        ls -la
        echo "ðŸ“ API content:"
        ls -la api/ || echo "No API folder"
        echo "ðŸ“ GitHub folder:"
        ls -la .github/ || echo "No .github folder"

    - name: Create zip package
      run: |
        zip -r deployment.zip . -x ".git/*" ".github/*" ".venv/*" "__pycache__/*" "*.gitignore"

    - name: Debug - Show zip contents
      run: |
        echo "ðŸ“¦ Zip file contents:"
        unzip -l deployment.zip | head -20

    - name: Setup Azure CLI
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Debug - List Azure Web Apps
      run: |
        echo "ðŸŒ Your Azure Web Apps:"
        az webapp list --query "[].{Name:name, State:state}" --output table

    - name: Deploy using Azure CLI
      run: |
        az webapp deploy \
          --name hamzamir-resume-app-gzgwc0d9f2csexgt \
          --resource-group $(az webapp show --name hamzamir-resume-app-gzgwc0d9f2csexgt --query resourceGroup -o tsv) \
          --src-path deployment.zip \
          --type zip

    - name: Verify deployment
      run: |
        echo "âœ… Deployment attempted"
        echo "Check https://hamzamir-resume-app-gzgwc0d9f2csexgt.azurewebsites.net"
=======
    - name: Zip project files
      run: zip -r deployment.zip . -x "*.git*" "*.github*" ".venv/*"

    - name: Deploy to Azure via Kudu
      run: |
        curl -X POST \
          -u '$hamzamir-resume-app-gzgwc0d9f2csexgt:${{ secrets.FTP_PASSWORD }}' \
          https://hamzamir-resume-app-gzgwc0d9f2csexgt.scm.azurewebsites.net/api/zipdeploy \
          --data-binary @deployment.zip
>>>>>>> 34241762a7f65891109211754af8eb882fab4a3d

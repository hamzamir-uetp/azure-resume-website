name: Deploy via Kudu API

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Zip project files
      run: zip -r deployment.zip . -x "*.git*" "*.github*" ".venv/*"

    - name: Deploy to Azure via Kudu
      run: |
        curl -X POST \
          -u '$hamzamir-resume-app-gzgwc0d9f2csexgt:${{ secrets.FTP_PASSWORD }}' \
          https://hamzamir-resume-app-gzgwc0d9f2csexgt.scm.azurewebsites.net/api/zipdeploy \
          --data-binary @deployment.zip
